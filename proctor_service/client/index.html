<!DOCTYPE html>
<html>
<head>
  <title>Lambda Test</title>
</head>
<body>

  <h1>Test AWS Connection</h1>

  <!-- Call Lambda Button -->
  <button id="testBtn">Call Lambda</button>
  <p id="output"></p>

  <hr>

  <!-- Create User Section -->
  <h2>Create Cognito User</h2>

  <label>Email:</label><br>
  <input id="emailInput" type="text" placeholder="Enter email"><br><br>

  <label>Role:</label><br>
  <select id="roleSelect">
    <option value="Teachers">Teachers</option>
    <option value="Students">Students</option>
  </select><br><br>

  <button id="createUserBtn">Create User</button>

  <p id="createUserOutput"></p>

  <hr>

  <!-- Upload Test Section -->
  <h2>Upload Test</h2>

  <label>Test ID:</label><br>
  <input id="testIdInput" type="text" placeholder="Enter test ID"><br><br>

  <label>Select test.json:</label><br>
  <input id="testJsonFile" type="file" accept="application/json"><br><br>

  <label>Select answers.json:</label><br>
  <input id="answersJsonFile" type="file" accept="application/json"><br><br>

  <button id="uploadTestBtn">Upload Test</button>

  <p id="uploadTestOutput"></p>


  <script>
    const { ipcRenderer } = require("electron");

    /* ---------------------------
       CALL TEST LAMBDA
    --------------------------- */
    document.getElementById("testBtn").addEventListener("click", async () => {
      const message = await ipcRenderer.invoke("callLambda");
      document.getElementById("output").innerText = message;
    });

    /* ---------------------------
       CALL CREATE USER LAMBDA
    --------------------------- */
    document.getElementById("createUserBtn").addEventListener("click", async () => {
      const email = document.getElementById("emailInput").value;
      const role = document.getElementById("roleSelect").value;

      const response = await ipcRenderer.invoke("createUser", {
        email,
        role
      });

      document.getElementById("createUserOutput").innerText =
        JSON.stringify(response, null, 2);
    });

    /* ---------------------------
     UPLOAD TEST
    --------------------------- */
    document.getElementById("uploadTestBtn").addEventListener("click", async () => {
      const testId = document.getElementById("testIdInput").value;
      const testFile = document.getElementById("testJsonFile").files[0];
      const answersFile = document.getElementById("answersJsonFile").files[0];

      if (!testId || !testFile || !answersFile) {
        document.getElementById("uploadTestOutput").innerText =
          "Missing Test ID or files.";
        return;
      }

      // Read JSON file contents
      const testJson = JSON.parse(await testFile.text());
      const answersJson = JSON.parse(await answersFile.text());

      const result = await ipcRenderer.invoke("uploadTest", {
        testId,
        testJson,
        answersJson
      });

      document.getElementById("uploadTestOutput").innerText =
        JSON.stringify(result, null, 2);
    });
  </script>

</body>
</html>
